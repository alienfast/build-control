{"version":3,"file":"build-control.es.js","sources":["../src/base.js","../src/paths.js","../src/baseSourced.js","../src/git.js","../src/npm.js","../src/buildControl.js"],"sourcesContent":["import extend from 'extend'\nimport stringify from 'stringify-object'\nimport shelljs from 'shelljs'\nimport chalk from 'chalk'\nimport fancyLog from 'fancy-log'\n\nexport const Default = {\n  debug: false,\n  sensitive: {},\n  cwd: 'dist'        // The directory that contains your built code.\n}\n\nconst Base = class {\n\n  /**\n   *\n   * @param config - customized overrides\n   */\n  constructor(config) {\n    this.config = extend(true, {}, Default, config)\n\n    this.debug(`[${this.constructor.name}] using resolved config: ${stringify(this.config)}`)\n  }\n\n  // ----------------------------------------------\n  // protected\n\n  codeExec(command, logResult = true) {\n    let code = this.exec(command, logResult, true)\n    this.debug(`codeExec result: ${code}`)\n    return code\n  }\n\n  booleanExec(command) {\n    if (this.codeExec(command, false) == 0) {\n      return true\n    }\n    else {\n      return false\n    }\n  }\n\n  /**\n   * Wraps shellJs calls that act on the file structure to give better output and error handling\n   * @param command\n   * @param logResult - return output from the execution, defaults to true. If false, will return code instead\n   * @param returnCode - defaults to false which will throw Error on error, true will return result code\n   */\n  exec(command, logResult = true, returnCode = false) {\n    let options = {silent: true}\n    if (this.config.cwd) {\n      options['cwd'] = this.config.cwd\n    }\n    else {\n      this.notifyError('cwd is required')\n    }\n\n    if(command.includes(`undefined`)){\n      this.notifyError(`Invalid command: ${command}`)\n    }\n\n    this.debug(`Executing \\`${command}\\` with cwd: ${options['cwd']}`)\n    let shellResult = shelljs.exec(command, options)\n    let output = this.logShellOutput(shellResult, logResult);\n\n    if (shellResult.code === 0 || shellResult.code === 1) {\n\n      // ---\n      // determine the return value\n      if (returnCode) {\n        return shellResult.code\n      }\n      else {\n        return output\n      }\n    }\n    else {\n      if (returnCode) {\n        return shellResult.code\n      }\n      else {\n        this.notifyError(`Command failed \\`${command}\\`, cwd: ${options.cwd}: ${shellResult.stderr}.`)\n      }\n    }\n  }\n\n  notifyError(msg){\n    this.error(msg)\n    throw new Error(this.maskSensitive(msg))\n  }\n\n  logShellOutput(shellResult, logResult) {\n    //this.debug(`[exit code] ${shellResult.code}`)\n\n    // ---\n    // Log the result\n    // strangely enough, sometimes useful messages from git are an stderr even when it is a successful command with a 0 result code\n    let output = shellResult.stdout\n    if (output == '') {\n      output = shellResult.stderr\n    }\n\n    //this.log(stringify(shellResult))\n    if (output != '') {\n      if (logResult) {\n        this.log(output)\n      }\n      else {\n        this.debug(`[output] \\n${output}`)\n      }\n    }\n    return output;\n  }\n\n  log(message, level = null){\n    let msg = ``\n    if(level){\n      msg += level\n    }\n    msg += `[${chalk.grey(this.constructor.name)}] ${message}`\n    fancyLog(this.maskSensitive(msg))\n  }\n\n  error(msg) {\n    this.log(msg, `[${chalk.red('error')}]`)\n  }\n\n  debug(msg) {\n    if (this.config.debug) {\n      this.log(msg, `[${chalk.cyan('debug')}]`)\n    }\n  }\n\n  maskSensitive(str) {\n    let result = str\n    for(let key of Object.keys(this.config.sensitive)){\n      result = result.replace(key, this.config.sensitive[key], 'gmi')\n    }\n    return result\n  }\n\n  debugDump(msg, obj) {\n    this.debug(`${msg}:\\n${stringify(obj)}`)\n  }\n}\n\nexport default Base\n","import path from 'path'\nimport pathIsAbsolute from 'path-is-absolute'\n\nconst Paths = class {\n\n  static resolveCwd(base, cwd) {\n    if (!pathIsAbsolute(cwd)) {\n      return path.join(base, cwd)\n    }\n    else {\n      return cwd\n    }\n  }\n}\n\nexport default Paths\n","import Base from './base'\nimport Paths from './paths'\nimport extend from 'extend'\nimport shelljs from 'shelljs'\n\nconst Default = {\n  sourceCwd: shelljs.pwd(), // The base directory of the source e.g. the directory of the package.json (not usually necessary to specify, but useful for odd structures and tests)\n  cwd: 'dist'        // The directory that contains your built code.\n}\n\nconst BaseSourced = class extends Base {\n\n  constructor(config = {}) {\n    super(extend(true, {}, Default, config))\n\n    // get a fully resolved sourceCwd based on the process cwd (if not an absolute path)\n    this.config.sourceCwd = Paths.resolveCwd(shelljs.pwd(), this.config.sourceCwd)\n\n    // get a fully resolved cwd based on the sourceCwd (if not an absolute path)\n    this.config.cwd = Paths.resolveCwd(this.config.sourceCwd, this.config.cwd)\n  }\n}\n\nexport default BaseSourced\n","import Base from './base'\nimport extend from 'extend'\nimport fs from 'fs'\nimport crypto from 'crypto'\nimport path from 'path'\n\nconst Default = {}\n\nconst Git = class extends Base {\n\n  constructor(config = {}) {\n    super(extend(true, {}, Default, config))\n  }\n\n  version() {\n    return (this.exec('git --version', false).match(/\\d+\\.\\d+\\.\\d+/) || []).shift()\n  }\n\n  diff() {\n    return this.exec('git diff', true)\n  }\n\n  ensureCommitted(){\n    let diff = this.diff()\n    if (diff !== '') {\n      this.notifyError(`There are uncommitted changes in your working directory ${this.config.cwd}. Please commit the changes first.`)\n    }\n    else {\n      this.debug(`No diffs (uncommitted changes) found.`)\n    }\n  }\n\n  sourceBranch() {\n    return this.exec('git rev-parse --abbrev-ref HEAD', false).replace(/\\n/g, '')\n  }\n\n  sourceCommit() {\n    return this.exec('git rev-parse --short HEAD', false).replace(/\\n/g, '')\n  }\n\n  sourceCommitFull() {\n    return this.exec('git rev-parse HEAD', false).replace(/\\n/g, '')\n  }\n\n  init() {\n    this.exec('git init')\n  }\n\n  configure(key, value) {\n    this.exec(`git config \"${key}\" \"${value}\"`)\n  }\n\n  remote() {\n    return this.exec('git remote', false)\n  }\n\n  remoteAdd(name, location) {\n    this.exec(`git remote add ${name} ${location}`)\n  }\n\n  /**\n   * Fetch remote refs to a specific branch, equivalent to a pull without checkout\n   */\n  fetch(remoteName, branch, shallow = false) {\n    let depth = shallow ? '--depth=1 ' : ''\n    // `--update-head-ok` allows fetch on a branch with uncommited changes\n    this.exec(`git fetch --progress --verbose --update-head-ok ${depth}${remoteName} ${branch}`) //, false, true)\n  }\n\n  /**\n   * Make the current working tree the branch HEAD without checking out files\n   * @param branch\n   */\n  symbolicRefHead(branch) {\n    this.exec(`git symbolic-ref HEAD refs/heads/${branch}`)\n  }\n\n  /**\n   * Make sure the stage is clean\n   */\n  reset() {\n    this.exec('git reset', false)\n  }\n\n  /**\n   *\n   * @param branch\n   * @param remoteName\n   * @param remoteBranch\n   */\n  track(branch, remoteName = 'origin', remoteBranch = null) {\n    if (remoteBranch == null) {\n      remoteBranch = branch\n    }\n    // Attempt to track a branch from origin\n    //  It may fail on times that the branch is already tracking another remote. There is no problem when that happens, nor does it have any affect\n    this.codeExec(`git branch --track ${branch} ${remoteName}/${remoteBranch}`, false)\n  }\n\n  checkout(branch) {\n    this.exec(`git checkout --orphan ${branch}`)\n  }\n\n  branchRemote(branch, remoteName, remoteBranch) {\n    this.exec(`git branch --set-upstream-to=${remoteName}/${remoteBranch} ${branch}`)\n  }\n\n  configBranchRemote(branch) {\n    try {\n      return this.exec(`git config branch.${branch}.remote`, false).replace(/\\n/g, '')\n    }\n    catch (error) {\n      return null\n    }\n  }\n\n  branchExists(branch) {\n    return this.booleanExec(`git show-ref --verify --quiet refs/heads/${branch}`)\n  }\n\n  branchRemoteExists(branch, remoteName) {\n    return this.booleanExec(`git ls-remote --exit-code ${remoteName} ${branch}`)\n  }\n\n  status(file = '') {\n    let result = this.exec(`git status -sb --porcelain ${file}`, false)\n    if (result === '') {\n      return null\n    }\n    else {\n      return result\n    }\n  }\n\n  add(file = `.`) {\n    this.exec(`git add -A ${file}`)\n  }\n\n  hash(prefix, text) {\n    return `${prefix}-${crypto.createHash('md5').update(text).digest('hex').substring(0, 6)}`\n  }\n\n  commit(message) {\n    // generate commit message\n    let commitMessageFile = path.join(this.config.cwd, this.hash('commitMessageFile', message))\n    fs.writeFileSync(commitMessageFile, message)\n    this.exec(`git commit --file=${commitMessageFile}`)\n\n    fs.unlinkSync(commitMessageFile)\n  }\n\n  tag(tag) {\n    this.exec(`git tag ${tag}`)\n  }\n\n  tagExists(tag, remoteName) {\n    return this.booleanExec(`git ls-remote --tags --exit-code ${remoteName} ${tag}`)\n  }\n\n  push(remoteName, branch, force = false) {\n    let withForce = force ? ' --force ' : ''\n\n    this.log(`Pushing ${branch} to ${remoteName}${withForce}`)\n    this.exec(`git push ${withForce}${remoteName} ${branch}`) //, false, true)\n  }\n\n  pushTag(remoteName, tag) {\n    this.exec(`git push ${remoteName} ${tag}`)\n  }\n}\n\nexport default Git\n","import BaseSourced from './baseSourced'\nimport Git from './git'\nimport extend from 'extend'\nimport fs from 'fs-extra'\nimport path from 'path'\nimport shelljs from 'shelljs'\n\nconst Default = {}\n\nconst Npm = class extends BaseSourced {\n\n  constructor(config = {}) {\n    super(extend(true, {}, Default, config))\n    this.sourceGit = new Git({cwd: this.config.sourceCwd, debug: this.config.debug, sensitive: this.config.sensitive})\n  }\n\n  publish() {\n    if(!this.hasPackage()){\n      return\n    }\n\n    this.exec('npm publish')\n  }\n\n  bump() {\n    if(!this.hasPackage()){\n      return\n    }\n\n    if(!this.config.versionBump){\n      return\n    }\n\n    this.sourceGit.ensureCommitted()\n\n    let fromVersion = this.package().version\n    this.exec(`npm --no-git-tag-version version ${this.config.versionBump}`)\n    this._package = null\n\n    let toVersion = this.package().version\n    this.sourceGit.add('package.json')\n    this.sourceGit.commit(`Bumped version from ${fromVersion} to ${toVersion}`)\n  }\n\n  package() {\n    if (this._package) {\n      return this._package\n    }\n    else {\n      return this._package = this.readPackage()\n    }\n  }\n\n  packageFile(){\n    return path.join(this.config.sourceCwd, 'package.json')\n  }\n\n  hasPackage(){\n    let file = this.packageFile()\n    if (shelljs.test('-f', file, {silent: true})) {\n      this.debug(`Found package.json at ${file}`)\n      return true\n    }\n    else {\n      this.debug(`package.json not found at ${file}`)\n      return false\n    }\n  }\n\n  readPackage() {\n    if (this.hasPackage()) {\n      return JSON.parse(fs.readFileSync(this.packageFile(), 'utf8'))\n    }\n    else {\n      return null\n    }\n  }\n}\n\nexport default Npm\n","import BaseSourced from './baseSourced'\nimport Git from './git'\nimport Npm from './npm'\nimport extend from 'extend'\nimport fs from 'fs-extra'\nimport path from 'path'\nimport url from 'url'\nimport semver from 'semver'\n\nconst Default = {\n  branch: 'dist',     // The branch to commit to.\n  versionBump: 'patch',   // Will bump the versino if package.json is present https://docs.npmjs.com/cli/version.  Pass false to avoid bump.\n  remote: {\n    repo: '../',      // The remote repo to push to (URL|RemoteName|FileSystemPath). Common examples include:\n                      //   - `git@github.com:alienfast/foo.git` - your main project's remote (gh-pages branch)\n                      //   - `../` - the local project repository itself\n\n    // If token && login are provided, the remote.repo will be formatted to include these\n    login: undefined,\n    token: undefined,\n    branch: undefined// The remote branch to push to. Common usage would be for Heroku's master branch requirement.\n  },\n  clean: { // clean the cwd dir before/after a run\n    before: false,\n    after: false\n  },\n  tag: {\n    name: undefined,   // fn or string.  Default will autoresolve from the package.json version if possible.  Pass false to avoid tagging.\n    existsFailure: false // if tag already exists, fail the executions\n  },\n  push: true,        // Pushes `branch` to remote. If tag is set, pushes the specified tag as well. false will disable\n  disableRelativeAutoPush: false, // when testing, we may have nothing to push to.  By default, if using a remote repo that is relative, will try to push using the config.branch using the sourceGit all the way to the server.\n  commit: {\n    auto: true,      // Commits built code to `branch`. A new commit is only created if the built code has changed. false will disable\n\n    // The commit template to use when committing. (special characters must be escaped)\n    //  The following tokens are replaced:\n    //    - %sourceName%:   the package.json name or the project directory name\n    //    - %sourceTag%: the current tag i.e. v1.0.0\n    //    - %sourceBranch%: the current branch\n    //    - %sourceCommit%: the most recent commit\n    template: `Built %sourceName% %sourceTag% from commit %sourceCommit% on branch %sourceBranch%`,\n    ensure: true // require the source and build to be fully committed prior to running.\n  },\n  fetch: {\n    shallow: false    // Fetches branch from remote with the flag --depth=1. Which makes a shallow clone with a history truncated to the last revision. Might bring some boost on long-history repositories.\n  },\n  git: {\n    config: {}         // [git config](http://git-scm.com/docs/git-config) settings for the repository when preparing the repository. e.g. `{'user.name': 'John Doe'}`\n  },\n  force: false     // Pushes branch to remote with the flag --force. This will NOT checkout the remote branch, and will OVERRIDE remote with the repo commits.  Use with caution.\n}\n\nconst BuildControl = class extends BaseSourced {\n\n  constructor(config = {}) {\n    super(extend(true, {},\n      Default,\n      {tag: {name: () => this.autoResolveTagName()}}, // tag package version auto resolver\n      config\n    ))\n\n    // modify\n\n    // Build remote repo if sensitive information is passed in\n    if (this.config.remote.login && this.config.remote.token) {\n      let remote = url.parse(this.config.remote.repo)\n\n      this.config.remote.repo = url.format({\n        protocol: remote.protocol,\n        auth: this.config.remote.login + ':' + this.config.remote.token,\n        host: remote.host,\n        pathname: remote.pathname\n      })\n\n      // configure sensitive information\n      this.config.sensitive[`${this.config.remote.login}:${this.config.remote.token}`] = '<credentials>'\n      this.config.sensitive[this.config.remote.token] = '<token>'\n    }\n\n    this.sourceGit = new Git({\n      debug: this.config.debug,\n      cwd: this.config.sourceCwd,\n      sensitive: this.config.sensitive\n    })\n\n    this.git = new Git({\n      debug: this.config.debug,\n      cwd: this.config.cwd,\n      sensitive: this.config.sensitive\n    })\n\n    this.npm = new Npm({\n      debug: this.config.debug,\n      cwd: this.config.cwd,\n      versionBump: this.config.versionBump,\n      sourceCwd: this.config.sourceCwd,\n      sensitive: this.config.sensitive\n    })\n\n    // Ensure/initialize\n    this.cleanBefore()\n    this.ensureDir()\n    if (this.config.remote.repo === '../') {\n      this.verifySourceBranchIsTracked()\n    }\n\n    // Set up repository\n    this.ensureGitInit()\n    this.configureGit()\n    this.ensureRemote()\n  }\n\n  ensureDir() {\n    // reestablish a build dir\n    fs.ensureDirSync(this.config.cwd)\n  }\n\n  cleanBefore() {\n    // clean dir\n    if (this.config.clean.before) {\n      fs.removeSync(this.config.cwd)\n    }\n  }\n\n  cleanAfter() {\n    // clean dir\n    if (this.config.clean.after) {\n      fs.removeSync(this.config.cwd)\n    }\n  }\n\n  resolveBranch() {\n    return (this.config.remote.branch || this.config.branch)\n  }\n\n  /**\n   *  Can run prior to tests etc to ensure versions are ready as well as commits.\n   */\n  prepublishCheck() {\n    // Check if git version meets requirements\n    let version = this.git.version()\n    if (!version || semver.lt(version, '1.8.0')) {\n      throw(`Current Git version is ${version}. This plugin requires Git >= 1.8.0.`)\n    }\n\n    // If config.commit.ensure is true check that the main project's working directory is clean\n    if (this.config.commit.ensure) {\n      this.git.ensureCommitted()\n      this.sourceGit.ensureCommitted()\n    }\n\n    if (this.config.fetch.shallow && semver.lt(version, '1.9.0')) {\n      this.notifyError(`Option \"fetch.shallow\" is supported on Git >= 1.9.0 and your version is ${version}.`)\n    }\n\n    // trigger message if tag exists in remote.\n    this.tagName()\n  }\n\n\n  prepublishBuildCheck() {\n    this.prepublishCheck()\n\n    // Check that build directory contains files\n    if (fs.readdirSync(this.config.cwd).length === 0) {\n      throw(`Build directory ${this.config.cwd} is empty. Nothing to version.`)\n    }\n\n    // Check that build directory exists\n    if (!fs.existsSync(this.config.cwd)) {\n      throw(`Build directory ${this.config.cwd} doesn't exist. Nothing to version.`)\n    }\n  }\n\n  /**\n   * Attempt to track a branch from origin. It may fail on times that the branch is already tracking another remote. There is no problem when that happens, nor does it have any affect\n   */\n  verifySourceBranchIsTracked() {\n    this.sourceGit.track(this.config.branch)\n  }\n\n  /**\n   * Initialize git repo if one doesn't exist\n   */\n  ensureGitInit() {\n    let repo = path.join(this.config.cwd, '.git')\n    if (!fs.existsSync(repo)) {\n      this.log(`Creating git repository in ${this.config.cwd}.`)\n      this.git.init()\n    }\n    else {\n      this.debug(`Git repo already exists in ${this.config.cwd}.`)\n    }\n  }\n\n  /**\n   * Initialize the git config\n   */\n  configureGit() {\n\n    this.debugDump(`this.config.git.config`, this.config.git.config)\n    for (let key of Object.keys(this.config.git.config)) {\n      this.git.configure(key, this.config.git.config[key])\n    }\n  }\n\n  /**\n   * Create a named remote if one doesn't exist\n   */\n  ensureRemote() {\n    let remoteUrlRegex = new RegExp('[\\/\\\\:]')\n    if (remoteUrlRegex.test(this.config.remote.repo)) {\n      this.config.remote.name = this.git.hash('remote', this.config.remote.repo)\n      if (!this.git.remote().includes(this.config.remote.name)) {\n        this.log(`Creating remote ${this.config.remote.name}`)\n        this.git.remoteAdd(this.config.remote.name, this.config.remote.repo)\n      }\n    }\n  }\n\n  /**\n   * Check if local branch can safely merge upstream (requires fetched refs)\n   * @returns {boolean}\n   */\n  shouldUpdate() {\n    // WARNING: With force, we're not even going to attempt to check out, We're just going to push the repo and override EVERYTHING in the remote\n    if (this.config.force === true) return false\n\n    let status = this.git.status()\n    if (status) {\n      let ahead = status.includes('ahead')\n      let behind = status.includes('behind')\n\n      if (ahead && behind) {\n        throw('The remote and local branches have diverged please\\n' +\n        'resolve manually. Deleting the local **built code**\\n' +\n        '.git directory will usually fix things up.')\n      }\n      else if (ahead) {\n        return false\n      }\n      else if (behind) {\n        return true\n      }\n    }\n  }\n\n  /**\n   * Fetch remote refs to a specific branch, equivalent to a pull without checkout\n   * @param dest\n   */\n  fetch(dest) {\n    let branch = this.resolveBranch() + (dest ? ':' + this.config.branch : '');\n    this.log(`Fetching '${this.config.branch}' ${(this.config.fetch.shallow ? 'files' : 'history')} from ${this.config.remote.repo}.`);\n    this.git.fetch(this.config.remote.name, branch, this.config.fetch.shallow)\n  }\n\n  /**\n   * Set branch to track remote\n   */\n  ensureLocalBranchTracksRemote() {\n    let remoteBranch = this.config.remote.branch || this.config.branch;\n    if (this.git.configBranchRemote(this.config.branch) !== this.config.remote.name) {\n      this.git.branchRemote(this.config.branch, this.config.remote.name, remoteBranch)\n    }\n  }\n\n  sourceName() {\n    if (this._sourceName) {\n      return this._sourceName\n    }\n    else {\n      if (this.npm.package() != null) {\n        this._sourceName = this.npm.package().name\n      }\n      else {\n        this._sourceName = this.config.sourceCwd.split('/').pop()\n      }\n\n      return this._sourceName\n    }\n  }\n\n  sourceCommit() {\n    if (this._sourceCommit) {\n      return this._sourceCommit\n    }\n    return this._sourceCommit = this.sourceGit.sourceCommit()\n  }\n\n  sourceCommitFull() {\n    if (this._sourceCommitFull) {\n      return this._sourceCommitFull\n    }\n    return this._sourceCommitFull = this.sourceGit.sourceCommitFull()\n  }\n\n  sourceCommitLink() {\n    return `[\\`%sourceCommit%\\`](../../commit/%sourceCommitFull%)`\n      .replace(/%sourceCommit%/g, this.sourceCommit())\n      .replace(/%sourceCommitFull%/g, this.sourceCommitFull())\n\n  }\n\n  sourceBranch() {\n    if (this._sourceBranch) {\n      return this._sourceBranch\n    }\n    return this._sourceBranch = this.sourceGit.sourceBranch()\n  }\n\n  sourceTag() {\n    if (this._sourceTag) {\n      return this._sourceTag\n    }\n    ''\n\n    let name = this.tagName()\n    if (name) {\n      this._sourceTag = name\n    }\n    else {\n      this._sourceTag = ''\n    }\n\n    return this._sourceTag\n  }\n\n  sourceTagLink() {\n    if (this.tagName()) {\n      return `[\\`%sourceTag%\\`](../../releases/tag/%sourceTag%)`\n        .replace(/%sourceTag%/g, this.sourceTag())\n    }\n    else {\n      return ''\n    }\n  }\n\n\n  interpolate(template) {\n    return template\n      .replace(/%sourceName%/g, this.sourceName())\n      .replace(/%sourceTag%/g, this.sourceTag())\n      .replace(/%sourceTagLink%/g, this.sourceTagLink())\n      .replace(/%sourceCommit%/g, this.sourceCommit())\n      .replace(/%sourceCommitFull%/g, this.sourceCommitFull())\n      .replace(/%sourceCommitLink%/g, this.sourceCommitLink())\n      .replace(/%sourceBranch%/g, this.sourceBranch())\n  }\n\n  /**\n   * Stage and commit to a branch\n   */\n  commit() {\n\n    if (!this.config.commit.auto) {\n      return\n    }\n\n    let message = this.interpolate(this.config.commit.template)\n\n    // If there are no changes, skip commit\n    if (!this.git.status()) {\n      this.log('No changes to your branch. Skipping commit.')\n      return\n    }\n\n    this.log(`Committing changes to '${this.config.branch}'.`)\n    this.git.add()\n    this.git.commit(message)\n  }\n\n  /**\n   * Tag local branch\n   */\n  tag() {\n    let tagName = this.tagName()\n    if (!tagName) {\n      return\n    }\n\n    this.log(`Tagging the local repository with ${tagName}`)\n    this.git.tag(tagName)\n  }\n\n  /**\n   * Convenience to resolve from a fn or string.  If tag already exists in a remote, it will return false (don't forget to bump your version in the package.json!)\n   */\n  tagName() {\n    if (this._tagName !== undefined) {\n      return this._tagName\n    }\n\n    if (this.config.tag.name === false) {\n      this._tagName = false\n    }\n    else if (this.config.tag.name === undefined) {\n      this._tagName = false\n    }\n    else {\n      let name = null\n      if (typeof this.config.tag.name === 'function') {\n        name = this.config.tag.name()\n      }\n      else {\n        name = this.config.tag.name\n      }\n\n      // If the tag exists, skip tagging\n      if (name && this.tagExists(name)) {\n        let msg = `The tag \"${name}\" already exists on ${this.config.remote.name}`\n        if (this.config.tag.existsFailure) {\n          this.notifyError(msg)\n        }\n        else {\n          this.log(`WARNING: ${msg}, skipping tagging.`)\n        }\n\n        name = false\n      }\n\n      this._tagName = name\n    }\n\n    return this._tagName\n  }\n\n  /**\n   * Resolver plugged into options as tag: {name: ()} that can be overridden by a string or other fn\n   */\n  autoResolveTagName() {\n    if (this.npm.package() && this.npm.package().version) {\n      return `v${this.npm.package().version}`\n    }\n    else {\n      return false\n    }\n  }\n\n  tagExists(name) {\n    if (this.git.tagExists(name, this.config.remote.name)) {\n      return true\n    }\n    else {\n      return false\n    }\n  }\n\n  /**\n   * Push branch to remote\n   */\n  push() {\n    if (!this.config.push) {\n      return\n    }\n\n    let branch = this.config.branch\n\n    if (this.config.remote.branch) {\n      branch += `:${this.config.remote.branch}`\n    }\n\n    this.git.push(this.config.remote.name, branch, this.config.force)\n    if (this.tagName()) {\n      this.git.pushTag(this.config.remote.name, this.tagName())\n    }\n\n    // if this was pushed to a relative path, go ahead and try and push that up to the origin\n    if (!this.config.disableRelativeAutoPush && this.config.remote.repo.includes('..')) {\n      let remote = 'origin'\n      this.log(`Repo is using relative path, pushing ${branch} from the source directory...`)\n      this.sourceGit.push(remote, branch)\n\n      if (this.tagName()) {\n        this.sourceGit.pushTag(remote, this.tagName())\n      }\n    }\n  }\n\n  localBranchExists() {\n    return this.git.branchExists(this.config.branch)\n  }\n\n  remoteBranchExists() {\n    return this.git.branchRemoteExists(this.resolveBranch(), this.config.remote.name)\n  }\n\n  run() {\n    // Run task\n    this.log(this.interpolate(`Starting %sourceName% for commit %sourceCommit% on branch %sourceBranch% using directory ${this.config.cwd}...`))\n\n    // Prepare\n    this.prepublishBuildCheck()\n\n    // Set up local branch\n    let localBranchExists = this.localBranchExists()\n    let remoteBranchExists = this.remoteBranchExists()\n\n    if (remoteBranchExists) {\n      this.fetch()\n    }\n\n    if (remoteBranchExists && localBranchExists) {\n      // Make sure local is tracking remote\n      this.ensureLocalBranchTracksRemote()\n\n      // Update local branch history if necessary\n      if (this.shouldUpdate()) {\n        this.fetch(true)\n      }\n    }\n    else if (remoteBranchExists && !localBranchExists) { //// TEST THIS ONE\n      // Create local branch that tracks remote\n      this.git.track(this.config.branch, this.config.remote.name, this.resolveBranch())\n    }\n    else if (!remoteBranchExists && !localBranchExists) {\n      // Create local branch\n      this.log(`Creating branch '${this.config.branch}'.`)\n      this.git.checkout(this.config.branch)\n    }\n\n    // Perform actions\n    this.git.symbolicRefHead(this.config.branch)\n    this.git.reset()\n\n    this.commit()\n    this.tag()\n    this.push()\n    this.cleanAfter()\n  }\n}\n\nexport default BuildControl\n"],"names":["Default","fs"],"mappings":"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"}